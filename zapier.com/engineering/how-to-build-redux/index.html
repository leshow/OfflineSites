



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" class="home-minimal-html ">
<head>


  
    
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-K7GFJTV');</script>
<!-- End Google Tag Manager -->

  

  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <meta name="author" content="Zapier" />
  <meta name="keywords" content="zapier, web apps, automation, syncing, integrations" />


  <meta name="robots" content="all" />


  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta http-equiv="X-UA-Compatible" content="chrome=IE8" /><script type="text/javascript">window.NREUM||(NREUM={}),__nr_require=function(e,n,t){function r(t){if(!n[t]){var o=n[t]={exports:{}};e[t][0].call(o.exports,function(n){var o=e[t][1][n];return r(o||n)},o,o.exports)}return n[t].exports}if("function"==typeof __nr_require)return __nr_require;for(var o=0;o<t.length;o++)r(t[o]);return r}({1:[function(e,n,t){function r(){}function o(e,n,t){return function(){return i(e,[c.now()].concat(u(arguments)),n?null:this,t),n?void 0:this}}var i=e("handle"),a=e(2),u=e(3),f=e("ee").get("tracer"),c=e("loader"),s=NREUM;"undefined"==typeof window.newrelic&&(newrelic=s);var p=["setPageViewName","setCustomAttribute","setErrorHandler","finished","addToTrace","inlineHit","addRelease"],d="api-",l=d+"ixn-";a(p,function(e,n){s[n]=o(d+n,!0,"api")}),s.addPageAction=o(d+"addPageAction",!0),s.setCurrentRouteName=o(d+"routeName",!0),n.exports=newrelic,s.interaction=function(){return(new r).get()};var m=r.prototype={createTracer:function(e,n){var t={},r=this,o="function"==typeof n;return i(l+"tracer",[c.now(),e,t],r),function(){if(f.emit((o?"":"no-")+"fn-start",[c.now(),r,o],t),o)try{return n.apply(this,arguments)}finally{f.emit("fn-end",[c.now()],t)}}}};a("setName,setAttribute,save,ignore,onEnd,getContext,end,get".split(","),function(e,n){m[n]=o(l+n)}),newrelic.noticeError=function(e){"string"==typeof e&&(e=new Error(e)),i("err",[e,c.now()])}},{}],2:[function(e,n,t){function r(e,n){var t=[],r="",i=0;for(r in e)o.call(e,r)&&(t[i]=n(r,e[r]),i+=1);return t}var o=Object.prototype.hasOwnProperty;n.exports=r},{}],3:[function(e,n,t){function r(e,n,t){n||(n=0),"undefined"==typeof t&&(t=e?e.length:0);for(var r=-1,o=t-n||0,i=Array(o<0?0:o);++r<o;)i[r]=e[n+r];return i}n.exports=r},{}],4:[function(e,n,t){n.exports={exists:"undefined"!=typeof window.performance&&window.performance.timing&&"undefined"!=typeof window.performance.timing.navigationStart}},{}],ee:[function(e,n,t){function r(){}function o(e){function n(e){return e&&e instanceof r?e:e?f(e,u,i):i()}function t(t,r,o,i){if(!d.aborted||i){e&&e(t,r,o);for(var a=n(o),u=m(t),f=u.length,c=0;c<f;c++)u[c].apply(a,r);var p=s[y[t]];return p&&p.push([b,t,r,a]),a}}function l(e,n){v[e]=m(e).concat(n)}function m(e){return v[e]||[]}function w(e){return p[e]=p[e]||o(t)}function g(e,n){c(e,function(e,t){n=n||"feature",y[t]=n,n in s||(s[n]=[])})}var v={},y={},b={on:l,emit:t,get:w,listeners:m,context:n,buffer:g,abort:a,aborted:!1};return b}function i(){return new r}function a(){(s.api||s.feature)&&(d.aborted=!0,s=d.backlog={})}var u="nr@context",f=e("gos"),c=e(2),s={},p={},d=n.exports=o();d.backlog=s},{}],gos:[function(e,n,t){function r(e,n,t){if(o.call(e,n))return e[n];var r=t();if(Object.defineProperty&&Object.keys)try{return Object.defineProperty(e,n,{value:r,writable:!0,enumerable:!1}),r}catch(i){}return e[n]=r,r}var o=Object.prototype.hasOwnProperty;n.exports=r},{}],handle:[function(e,n,t){function r(e,n,t,r){o.buffer([e],r),o.emit(e,n,t)}var o=e("ee").get("handle");n.exports=r,r.ee=o},{}],id:[function(e,n,t){function r(e){var n=typeof e;return!e||"object"!==n&&"function"!==n?-1:e===window?0:a(e,i,function(){return o++})}var o=1,i="nr@id",a=e("gos");n.exports=r},{}],loader:[function(e,n,t){function r(){if(!x++){var e=h.info=NREUM.info,n=d.getElementsByTagName("script")[0];if(setTimeout(s.abort,3e4),!(e&&e.licenseKey&&e.applicationID&&n))return s.abort();c(y,function(n,t){e[n]||(e[n]=t)}),f("mark",["onload",a()+h.offset],null,"api");var t=d.createElement("script");t.src="https://"+e.agent,n.parentNode.insertBefore(t,n)}}function o(){"complete"===d.readyState&&i()}function i(){f("mark",["domContent",a()+h.offset],null,"api")}function a(){return E.exists&&performance.now?Math.round(performance.now()):(u=Math.max((new Date).getTime(),u))-h.offset}var u=(new Date).getTime(),f=e("handle"),c=e(2),s=e("ee"),p=window,d=p.document,l="addEventListener",m="attachEvent",w=p.XMLHttpRequest,g=w&&w.prototype;NREUM.o={ST:setTimeout,SI:p.setImmediate,CT:clearTimeout,XHR:w,REQ:p.Request,EV:p.Event,PR:p.Promise,MO:p.MutationObserver};var v=""+location,y={beacon:"bam.nr-data.net",errorBeacon:"bam.nr-data.net",agent:"js-agent.newrelic.com/nr-1044.min.js"},b=w&&g&&g[l]&&!/CriOS/.test(navigator.userAgent),h=n.exports={offset:u,now:a,origin:v,features:{},xhrWrappable:b};e(1),d[l]?(d[l]("DOMContentLoaded",i,!1),p[l]("load",r,!1)):(d[m]("onreadystatechange",o),p[m]("onload",r)),f("mark",["firstbyte",u],null,"api");var x=0,E=e(4)},{}]},{},["loader"]);</script><script type="text/javascript">window.NREUM||(NREUM={});NREUM.info={"beacon":"bam.nr-data.net","queueTime":0,"licenseKey":"c342879a4c","agent":"","transactionName":"M1ZRYEQCXktZUkNdCgocdUFYAERRV18YVgkLVB1CXwZHSwJHXlESO1ZdQEQa","applicationID":"17152027","errorBeacon":"bam.nr-data.net","applicationTime":907}</script>
  <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE9" />
  <meta name="google-site-verification" content="Mplw0unXm1SQzihRuuBFgiBxjBXgfRw64bSZCfEUhlw" />
  <meta name="pocket-site-verification" content="e3616a9b06fea1f1ec3cc8180f2a68" />
  
  
  <meta property="og:site_name" content="The Zapier Engineering Blog" />

  <meta property="article:publisher" content="https://www.facebook.com/ZapierApp" />
  <meta name="twitter:site" content="@zapier">

  <meta property="og:title" content="Build Yourself a Redux" />
  <meta name="twitter:title" content="Build Yourself a Redux">

  <meta property="og:type" content="article" />
  <meta property="og:url" content="https://zapier.com/engineering/how-to-build-redux/" />

  <meta name="twitter:description" content="Redux is a simple library that helps you manage the state of your JavaScript app. Despite that simplicity, it&#39;s easy to fall down rabbit holes when learning it. I often find myself explaining Redux, and almost always start by showing how I&#39;d implement it. So that&#39;s what...">
  <meta property="og:description" content="Redux is a simple library that helps you manage the state of your JavaScript app. Despite that simplicity, it&#39;s easy to fall down rabbit holes when learning it. I often find myself explaining Redux, and almost always start by showing how I&#39;d implement it. So that&#39;s what..." />

  <meta name="twitter:card" content="summary_large_image">

  
    <meta name="twitter:creator" content="@justindeal">
  

  
    <meta name="og:image" content="https://cdn.zapier.com/storage/blog/4ec8fc7dc3a75758a3913bab9e5a4fd8_2.1800x1000.png">
    <meta name="twitter:image:src" content="https://cdn.zapier.com/storage/blog/4ec8fc7dc3a75758a3913bab9e5a4fd8_2.500x278.png">
  



  <title>Build Yourself a Redux - The Zapier Engineering Blog - Zapier</title>
  <meta name="description" content="Redux is a simple library that helps you manage the state of your JavaScript app. Despite that simplicity, it&#39;s easy to fall down rabbit holes when learning it. I often find myself explaining Redux, and almost always start by showing how I&#39;d implement it. So that&#39;s what..."></meta>

  <link rel="alternate" href="index.html" hreflang="en" />
  <link rel="alternate" href="index.html" hreflang="x-default" />

  <link rel="mask-icon" href="https://cdn.zapier.com/static/1DNUis/images/logo_zapier_black.svg" color="#FF4A00" />
  
    <link rel="icon" href="https://cdn.zapier.com/static/1DNUis/images/favicon.ico" type="image/x-icon" />
    <link rel="shortcut icon" href="https://cdn.zapier.com/static/1DNUis/images/favicon.ico" type="image/x-icon" />
  

  
  <link rel="canonical" href="index.html" />
  

  
  <link rel="alternate" type="application/rss+xml" title="The Zapier Engineering Blog" href="https://zapier.com/engineering/feeds/latest/" />


  <script type="text/javascript">
    var DEBUG = false;

    var preload = {};
    var BASE_CONFIG = BASE_CONFIG || {};

    BASE_CONFIG.path = '/engineering/how-to-build-redux/';
    BASE_CONFIG.mediaUrl = 'https://cdn.zapier.com/static/1DNUis/';
    BASE_CONFIG.stripePubApiKey = 'pk_phnG9Y3BlUIYXVpH1gkMOJ25RGbsI';
    BASE_CONFIG.pusherAppKey = 'dc30b79cf9b16933060a';
    
    BASE_CONFIG.personas = [
  "Contractor", 
  "Customer Support", 
  "Designer", 
  "Developer", 
  "Education", 
  "Freelancer", 
  "Government", 
  "Human Resource", 
  "Information Technology", 
  "Journalist", 
  "Lawyer", 
  "Marketer", 
  "Non-Profit", 
  "Real Estate", 
  "Sales", 
  "Small Business Owner", 
  "Other"
];
    
  </script>

  










<script type="text/javascript">
  window.tests = window.tests || {};
  
  window.tests.promptUpgradeEditor = true;
  window.tests.shouldShowTopBar = false;
</script>


  
    <link href="https://cdn.zapier.com/static/1DNUis/build/app.css" rel="stylesheet" type="text/css" />
    <link href="https://cdn.zapier.com/static/1DNUis/build/view.css" rel="stylesheet" type="text/css" />
    
      <link href="https://cdn.zapier.com/static/1DNUis/build/common-bundle.css" rel="stylesheet" type="text/css" />
      <link href="https://cdn.zapier.com/static/1DNUis/build/app-bundle.css" rel="stylesheet" type="text/css" />
    
  

  
</head>

<body id="" class="disable-focus-outline">

  
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-K7GFJTV"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->



  



  <div id="header" class="secondary-blog">
    <div class="container">

      <div class="engineering-logo">
        <a href="https://zapier.com/engineering/"></a>
      </div>

      <div class="blog-title"><a href="https://zapier.com/engineering/">Zapier Engineering</a></div>

      <div class="links-container">
        <ul class="links">
          <li><a href="https://zapier.com/developer/">Developer Platform</a></li>
          <li><a href="https://zapier.com/about/">Jobs</a></li>
          <li><a href="https://zapier.com/">Zapier.com</a></li>
        </ul>
      </div>
    </div>
  </div>



  <div id="static-content"></div>
  <div id="react-root-app">
    <div id="app" class="app">
      
  <div class="content-base secondary-blog fixed-header-padding">
    <div class="row">
      <div class="container">
        <div class="column two-thirds content secondary-blog-entry-engineering">
          
          
  <h1>Build Yourself a Redux</h1>
  

  <div class="author-top">
    <div class="table-wrapper">
      <div class="table-cell">
        <div class="picture" title="Justin Deal">
          <img src="https://secure.gravatar.com/avatar/d266d8fcf04d5d065ca632e642d01dcd.jpg?s=75&amp;r=G" alt="Justin Deal"/>
        </div>
      </div>
      <div class="text table-cell vcenter">
        Justin Deal / April 27, 2017
      </div>
    </div>
  </div>

  <p>Redux is a simple library that helps you manage the state of your JavaScript app. Despite that simplicity, it's easy to fall down rabbit holes when learning it. I often find myself explaining Redux, and almost always start by showing how I'd implement it. So that's what we'll do here: Start from scratch and build a working Redux implementation. Our implementation won't cover every nuance, but we'll remove most of the mystery.</p>
<p class="related-content">At Zapier, we love digging into these frontend topics. Sound like something you'd be into? We're currently hiring <a href="https://zapier.com/jobs/frontend-engineer/">frontend engineers</a>. We'd love to hear from you.<br /></p>
<p>Note that technically we'll be building <a href="https://github.com/reactjs/redux">Redux</a> <em>and</em> <a href="https://github.com/reactjs/react-redux">React Redux</a>. At Zapier, we pair Redux with the (awesome) UI library <a href="https://facebook.github.io/react/">React</a>, and that's the pairing that shows up most in the wild. But even if you use Redux with something else, most everything here will still apply.</p>
<p>Let's get started!</p>
<style>
.codehilite .err, .pygments .err, div.highlight .err {
  border: 0px;
}
</style>

<h2>Bring Your Own State Object</h2>
<p>Most useful apps will get their state from a server, but let's start by creating our state locally. Even if we are retrieving from the server, we have to seed the app with something anyway. Our app will be a simple note-taking app. This is mostly to avoid making yet another todo app, but it will also force us to make an interesting state decision later.</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">initialState</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">nextNoteId</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="nx">notes</span><span class="o">:</span> <span class="p">{}</span>
<span class="p">};</span>
</pre></div>


<p>So first of all, notice our data is just a plain JS object. Redux helps <em>manage changes to your state</em>, but it doesn't really care much about the state itself.</p>
<h2>Why Redux?</h2>
<p>Before we dig any deeper, let's see what it's like to build our app without Redux. Let's just go ahead and attach our <code>initialState</code> object to <code>window</code> like this:</p>
<div class="codehilite"><pre><span></span><span class="nb">window</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="nx">initialState</span><span class="p">;</span>
</pre></div>


<p>Boom, there's our store! We don't need no stinking Redux. Let's make a component that adds new notes.</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">onAddNote</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">id</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">nextNoteId</span><span class="p">;</span>
  <span class="nb">window</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">notes</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">id</span><span class="p">,</span>
    <span class="nx">content</span><span class="o">:</span> <span class="s1">&#39;&#39;</span>
  <span class="p">};</span>
  <span class="nb">window</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">nextNoteId</span><span class="o">++</span><span class="p">;</span>
  <span class="nx">renderApp</span><span class="p">();</span>
<span class="p">};</span>

<span class="kr">const</span> <span class="nx">NoteApp</span> <span class="o">=</span> <span class="p">({</span><span class="nx">notes</span><span class="p">})</span> <span class="o">=&gt;</span> <span class="p">(</span>
  <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">ul</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&quot;note-list&quot;</span><span class="o">&gt;</span>
    <span class="p">{</span>
      <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">notes</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="nx">id</span> <span class="o">=&gt;</span> <span class="p">(</span>
        <span class="c1">// Obviously we should render something more interesting than the id.</span>
        <span class="o">&lt;</span><span class="nx">li</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&quot;note-list-item&quot;</span> <span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="nx">id</span><span class="p">}</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">id</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/li&gt;</span>
      <span class="p">))</span>
    <span class="p">}</span>
    <span class="o">&lt;</span><span class="err">/ul&gt;</span>
    <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&quot;editor-button&quot;</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">onAddNote</span><span class="p">}</span><span class="o">&gt;</span><span class="nx">New</span> <span class="nx">Note</span><span class="o">&lt;</span><span class="err">/button&gt;</span>
  <span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="p">);</span>

<span class="kr">const</span> <span class="nx">renderApp</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">NoteApp</span> <span class="nx">notes</span><span class="o">=</span><span class="p">{</span><span class="nb">window</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">notes</span><span class="p">}</span><span class="o">/&gt;</span><span class="p">,</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;root&#39;</span><span class="p">)</span>
  <span class="p">);</span>
<span class="p">};</span>

<span class="nx">renderApp</span><span class="p">();</span>
</pre></div>


<p>You can try out this example live with <a href="https://jsfiddle.net">JSFiddle</a>. Just click on the Result tab to play with the app. Use the "Edit in JSFiddle" link if you want to play with the code.</p>
<iframe width="100%" height="300" src="https://jsfiddle.net/justindeal/5j3can1z/1/embedded/js,result/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>

<p>Not a very useful app, but what's there works fine. Seems like we've proved we can get by without Redux. So this blog post is done, right?</p>
<p>Not just yet&hellip;</p>
<p>Let's look down the road a little bit. We add a bunch of features, build a nice backend for it, start a company so we can sell subscriptions, get lots of customers, add lots of new features, make some money, grow the company&hellip; okay, we're getting a little ahead of ourselves.</p>
<p>It's difficult to see in this simple example, but on our road to success, our app may grow to include hundreds of components across hundreds of files. Our app will have asynchronous actions, so we'll have code like this:</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">onAddNote</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nb">window</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">onLoading</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="nx">renderApp</span><span class="p">();</span>
  <span class="nx">api</span><span class="p">.</span><span class="nx">createNote</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">note</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">onLoading</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">notes</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">note</span><span class="p">;</span>
      <span class="nx">renderApp</span><span class="p">();</span>      
    <span class="p">});</span>
<span class="p">};</span>
</pre></div>


<p>And we'll have bugs like this:</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">ARCHIVE_TAG_ID</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">onAddTag</span> <span class="o">=</span> <span class="p">(</span><span class="nx">noteId</span><span class="p">,</span> <span class="nx">tagId</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nb">window</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">onLoading</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="c1">// Whoops, forgetting to render here!</span>
  <span class="c1">// For quick local server, we might not notice.</span>
  <span class="nx">api</span><span class="p">.</span><span class="nx">addTag</span><span class="p">(</span><span class="nx">noteId</span><span class="p">,</span> <span class="nx">tagId</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">onLoading</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">tagMapping</span><span class="p">[</span><span class="nx">tagId</span><span class="p">]</span> <span class="o">=</span> <span class="nx">noteId</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">ARCHIVE_TAG_ID</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Whoops, some naming bugs here. Probably from a</span>
        <span class="c1">// rogue search and replace. Won&#39;t be noticed till</span>
        <span class="c1">// we test that archive page that nobody really uses.</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">archived</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">archive</span> <span class="o">||</span> <span class="p">{};</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">archived</span><span class="p">[</span><span class="nx">noteId</span><span class="p">]</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">notes</span><span class="p">[</span><span class="nx">noteId</span><span class="p">];</span>
        <span class="k">delete</span> <span class="nb">window</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">notes</span><span class="p">[</span><span class="nx">noteId</span><span class="p">];</span>
      <span class="p">}</span>
      <span class="nx">renderApp</span><span class="p">();</span>
    <span class="p">});</span>
<span class="p">};</span>
</pre></div>


<p>And some hacky ad-hoc state changes like this that nobody even knows what they do:</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">SomeEvilComponent</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="nb">window</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">pureEvil</span> <span class="o">=</span> <span class="kc">true</span><span class="p">}</span><span class="o">&gt;</span><span class="nx">Do</span> <span class="nx">Evil</span><span class="o">&lt;</span><span class="err">/button&gt;</span>
<span class="p">};</span>
</pre></div>


<p>Add this all up across a large codebase with many developers over a long period of time, and we have a mounting set of problems:</p>
<ol>
<li>Rendering can be kicked off from anywhere. There will probably be weird UI glitches or unresponsiveness at seemingly random times.</li>
<li>Race conditions are lurking, even in the little bit of code we see here.</li>
<li>This mess is nearly impossible to test. You have to get the <em>whole</em> app in a specific state, then poke at it with a stick, and check the state of the <em>whole</em> app to see if it's what you expect.</li>
<li>If you have a bug, you can make some educated guesses about where to look, but ultimately, every single line of your app is a potential suspect.</li>
</ol>
<p>That last point is by far the worst problem and the main reason to choose Redux. If you want to shrink the complexity of your app, the best thing to do (in my opinion) is to constrain how and where you can change the state of your app. Redux isn't a panacea for the other problems, but they will likely diminish because of the same constraints.</p>
<h2>The Reducer</h2>
<p>So how does Redux provide those constraints and help you manage state? Well, you start with a simple function that takes the current state and an action and returns the new state. So for our note-taking app, if we provide an action that adds a note, we should get a new state that has our note added to it.</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">CREATE_NOTE</span> <span class="o">=</span> <span class="s1">&#39;CREATE_NOTE&#39;</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">UPDATE_NOTE</span> <span class="o">=</span> <span class="s1">&#39;UPDATE_NOTE&#39;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">reducer</span> <span class="o">=</span> <span class="p">(</span><span class="nx">state</span> <span class="o">=</span> <span class="nx">initialState</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">switch</span> <span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="nx">CREATE_NOTE</span><span class="o">:</span>
      <span class="k">return</span> <span class="c1">// some new state with new note</span>
    <span class="k">case</span> <span class="nx">UPDATE_NOTE</span><span class="o">:</span>
      <span class="k">return</span> <span class="c1">// some new state with note updated</span>
    <span class="k">default</span><span class="o">:</span>
      <span class="k">return</span> <span class="nx">state</span>
  <span class="p">}</span>
<span class="p">};</span>
</pre></div>


<p>If <code>switch</code> statements make you nauseous, you don't have to write your reducer that way. I usually use an object and point a key for each type to its corresponding handler like this:</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">handlers</span> <span class="o">=</span> <span class="p">{</span>
  <span class="p">[</span><span class="nx">CREATE_NOTE</span><span class="p">]</span><span class="o">:</span> <span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="c1">// some new state with new note</span>
  <span class="p">},</span>
  <span class="p">[</span><span class="nx">UPDATE_NOTE</span><span class="p">]</span><span class="o">:</span> <span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="c1">// some new state with note updated</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="kr">const</span> <span class="nx">reducer</span> <span class="o">=</span> <span class="p">(</span><span class="nx">state</span> <span class="o">=</span> <span class="nx">initialState</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">handlers</span><span class="p">[</span><span class="nx">action</span><span class="p">.</span><span class="nx">type</span><span class="p">])</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">handlers</span><span class="p">[</span><span class="nx">action</span><span class="p">.</span><span class="nx">type</span><span class="p">](</span><span class="nx">state</span><span class="p">,</span> <span class="nx">action</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">state</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>


<p>That part isn't too important though. The reducer is your function, and you can implement it however you want. Redux really doesn't care.</p>
<h3>Immutability</h3>
<p>What Redux <em>does</em> care about is that your reducer is a <em>pure</em> function. Meaning, you should never, ever, ever in a million years implement your reducer like this:</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">reducer</span> <span class="o">=</span> <span class="p">(</span><span class="nx">state</span> <span class="o">=</span> <span class="nx">initialState</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">switch</span> <span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="nx">CREATE_NOTE</span><span class="o">:</span> <span class="p">{</span>
      <span class="c1">// DO NOT MUTATE STATE LIKE THIS!!!</span>
      <span class="nx">state</span><span class="p">.</span><span class="nx">notes</span><span class="p">[</span><span class="nx">state</span><span class="p">.</span><span class="nx">nextNoteId</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">id</span><span class="o">:</span> <span class="nx">state</span><span class="p">.</span><span class="nx">nextNoteId</span><span class="p">,</span>
        <span class="nx">content</span><span class="o">:</span> <span class="s1">&#39;&#39;</span>
      <span class="p">};</span>
      <span class="nx">state</span><span class="p">.</span><span class="nx">nextNoteId</span><span class="o">++</span><span class="p">;</span>
      <span class="k">return</span> <span class="nx">state</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">case</span> <span class="nx">UPDATE_NOTE</span><span class="o">:</span> <span class="p">{</span>
      <span class="c1">// DO NOT MUTATE STATE LIKE THIS!!!</span>
      <span class="nx">state</span><span class="p">.</span><span class="nx">notes</span><span class="p">[</span><span class="nx">action</span><span class="p">.</span><span class="nx">id</span><span class="p">].</span><span class="nx">content</span> <span class="o">=</span> <span class="nx">action</span><span class="p">.</span><span class="nx">content</span><span class="p">;</span>
      <span class="k">return</span> <span class="nx">state</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">default</span><span class="o">:</span>
      <span class="k">return</span> <span class="nx">state</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>
</pre></div>


<p>As a practical matter, if you mutate state like that, Redux simply won't work. Because you're mutating state, the object references won't change, so the parts of your app simply won't update correctly. It'll also make it impossible to use some Redux developer tools, because those tools keep track of previous states. If you're constantly mutating state, there's no way to go back to those previous states.</p>
<p>As a matter of principal, mutating state makes it harder to build your reducer (and potentially other parts of your app) from composable parts. Pure functions are predictable, because they produce the same output when given the same input. If you make a habit of mutating state, all bets are off. Calling a function becomes indeterminate. You have to keep the whole tree of functions in your head at once.</p>
<p>This predictability comes at a cost though, especially since JavaScript doesn't natively support immutable objects. For our examples, we'll make do with vanilla JavaScript, which will add some verbosity. Here's how we really need to write that reducer:</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">reducer</span> <span class="o">=</span> <span class="p">(</span><span class="nx">state</span> <span class="o">=</span> <span class="nx">initialState</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">switch</span> <span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="nx">CREATE_NOTE</span><span class="o">:</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">state</span><span class="p">.</span><span class="nx">nextNoteId</span><span class="p">;</span>
      <span class="kr">const</span> <span class="nx">newNote</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">id</span><span class="p">,</span>
        <span class="nx">content</span><span class="o">:</span> <span class="s1">&#39;&#39;</span>
      <span class="p">};</span>
      <span class="k">return</span> <span class="p">{</span>
        <span class="p">...</span><span class="nx">state</span><span class="p">,</span>
        <span class="nx">nextNoteId</span><span class="o">:</span> <span class="nx">id</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
        <span class="nx">notes</span><span class="o">:</span> <span class="p">{</span>
          <span class="p">...</span><span class="nx">state</span><span class="p">.</span><span class="nx">notes</span><span class="p">,</span>
          <span class="p">[</span><span class="nx">id</span><span class="p">]</span><span class="o">:</span> <span class="nx">newNote</span>
        <span class="p">}</span>
      <span class="p">};</span>
    <span class="p">}</span>
    <span class="k">case</span> <span class="nx">UPDATE_NOTE</span><span class="o">:</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="p">{</span><span class="nx">id</span><span class="p">,</span> <span class="nx">content</span><span class="p">}</span> <span class="o">=</span> <span class="nx">action</span><span class="p">;</span>
      <span class="kr">const</span> <span class="nx">editedNote</span> <span class="o">=</span> <span class="p">{</span>
        <span class="p">...</span><span class="nx">state</span><span class="p">.</span><span class="nx">notes</span><span class="p">[</span><span class="nx">id</span><span class="p">],</span>
        <span class="nx">content</span>
      <span class="p">};</span>
      <span class="k">return</span> <span class="p">{</span>
        <span class="p">...</span><span class="nx">state</span><span class="p">,</span>
        <span class="nx">notes</span><span class="o">:</span> <span class="p">{</span>
          <span class="p">...</span><span class="nx">state</span><span class="p">.</span><span class="nx">notes</span><span class="p">,</span>
          <span class="p">[</span><span class="nx">id</span><span class="p">]</span><span class="o">:</span> <span class="nx">editedNote</span>
        <span class="p">}</span>
      <span class="p">};</span>
    <span class="p">}</span>
    <span class="k">default</span><span class="o">:</span>
      <span class="k">return</span> <span class="nx">state</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>
</pre></div>


<p>I'm using <a href="https://github.com/tc39/proposal-object-rest-spread">object spread properties</a> (<code>...</code>) here which aren't technically part of ECMAScript yet, but it's a pretty safe bet that they will be. <code>Object.assign</code> can be used if you want to avoid non-standard features. The concept is the same either way: Don't change the state. Instead, create shallow copies of the state and any nested objects/arrays. For any parts of an object that don't change, we just reference the existing parts. If we take a closer look at this code:</p>
<div class="codehilite"><pre><span></span><span class="k">return</span> <span class="p">{</span>
  <span class="p">...</span><span class="nx">state</span><span class="p">,</span>
  <span class="nx">notes</span><span class="o">:</span> <span class="p">{</span>
    <span class="p">...</span><span class="nx">state</span><span class="p">.</span><span class="nx">notes</span><span class="p">,</span>
    <span class="p">[</span><span class="nx">id</span><span class="p">]</span><span class="o">:</span> <span class="nx">editedNote</span>
  <span class="p">}</span>
<span class="p">};</span>
</pre></div>


<p>We're only changing the <code>notes</code> property, so other properties of <code>state</code> will remain exactly the same. The <code>...state</code> just says to re-use those existing properties as-is. Similarly, within <code>notes</code>, we're only changing the one note we're editing. The other notes that are part of <code>...state.notes</code> will remain untouched. This way, we can leverage <a href="https://facebook.github.io/react/docs/react-component.html#shouldcomponentupdate"><code>shouldComponentUpdate</code></a>. If a component has an unchanged note as a prop, it can avoid re-rendering. Keeping that in mind, we also have to avoid writing our reducer like this:</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">reducer</span> <span class="o">=</span> <span class="p">(</span><span class="nx">state</span> <span class="o">=</span> <span class="nx">initialState</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// Well, we avoid mutation, but still... DON&#39;T DO THIS!</span>
  <span class="nx">state</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">cloneDeep</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span>
  <span class="k">switch</span> <span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
    <span class="k">case</span> <span class="nx">UPDATE_NOTE</span><span class="o">:</span> <span class="p">{</span>
      <span class="c1">// Hey, now I can do good old mutations.</span>
      <span class="nx">state</span><span class="p">.</span><span class="nx">notes</span><span class="p">[</span><span class="nx">action</span><span class="p">.</span><span class="nx">id</span><span class="p">].</span><span class="nx">content</span> <span class="o">=</span> <span class="nx">action</span><span class="p">.</span><span class="nx">content</span><span class="p">;</span>
      <span class="k">return</span> <span class="nx">state</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">default</span><span class="o">:</span>
      <span class="k">return</span> <span class="nx">state</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>
</pre></div>


<p>That gives back your terse mutation code, and Redux will <em>technically</em> work if you do that, but you'll knee-cap all potential optimizations. Every single object and array will be brand-new for every state change, so any components depending on those objects and arrays will have to re-render, even if you didn't actually do any mutations.</p>
<p>Our immutable reducer definitely requires more typing and a little more cognitive effort. But over time, you'll tend to appreciate that your state-changing functions are isolated and easy to test. For a real app, you <em>might</em> want to look at something like <a href="https://github.com/lodash/lodash/wiki/FP-Guide">lodash-fp</a>, or <a href="http://ramdajs.com/">Ramda</a> or <a href="https://facebook.github.io/immutable-js/">Immutable.js</a>. At Zapier, we use a variant of <a href="https://github.com/kolodny/immutability-helper">immutability-helper</a> which is pretty simple. I'll warn you that this is a pretty big rabbit hole though. I even started writing a <a href="https://github.com/jdeal/qim">library with a different spin</a>. Vanilla JS is fine too and will likely play better with strong typing solutions like <a href="https://flow.org/">Flow</a> and <a href="https://www.typescriptlang.org/">TypeScript</a>. Just make sure to stick with smaller functions. It's much like the tradeoff you make with React: you might end up with more code than the equivalent jQuery solution, but each component is far more predictable.</p>
<h3>Using our Reducer</h3>
<p>Let's plug an action into our reducer and get out a new state.</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">state0</span> <span class="o">=</span> <span class="nx">reducer</span><span class="p">(</span><span class="kc">undefined</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">type</span><span class="o">:</span> <span class="nx">CREATE_NOTE</span>
<span class="p">});</span>
</pre></div>


<p>Now <code>state0</code> looks like this:</p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nx">nextNoteId</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
  <span class="nx">notes</span><span class="o">:</span> <span class="p">{</span>
    <span class="mi">1</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">id</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
      <span class="nx">content</span><span class="o">:</span> <span class="s1">&#39;&#39;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>Notice we fed <code>undefined</code> in as the state in this case. Redux always passes in <code>undefined</code> as the initial state, and typically you use a default parameter like <code>state = initialState</code> to pick up your initial state object. The next time through, Redux will feed in the previous state.</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">state1</span>  <span class="o">=</span> <span class="nx">reducer</span><span class="p">(</span><span class="nx">state0</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">type</span><span class="o">:</span> <span class="nx">UPDATE_NOTE</span><span class="p">,</span>
  <span class="nx">id</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="nx">content</span><span class="o">:</span> <span class="s1">&#39;Hello, world!&#39;</span>
<span class="p">});</span>
</pre></div>


<p>Now <code>state1</code> looks like this:</p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nx">nextNoteId</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
  <span class="nx">notes</span><span class="o">:</span> <span class="p">{</span>
    <span class="mi">1</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">id</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
      <span class="nx">content</span><span class="o">:</span> <span class="s1">&#39;Hello, world!&#39;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>You can play with our reducer here. Follow the "Edit in JSFiddle" link to edit the code and try other actions. I'll wait here!</p>
<iframe width="100%" height="300" src="https://jsfiddle.net/justindeal/kLkjt4y3/3/embedded/js,result/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>

<p>Of course, Redux doesn't keep making more variables like this, but we'll get to a real implementation soon enough. The point is that the core of Redux is really just a piece of code that you write, a simple function that takes the previous state and an action and returns the next state. Why is that function called a reducer? Because it would plug right into a standard <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce"><code>reduce</code></a> function.</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">actions</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">CREATE_NOTE</span><span class="p">},</span>
  <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">UPDATE_NOTE</span><span class="p">,</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">content</span><span class="o">:</span> <span class="s1">&#39;Hello, world!&#39;</span><span class="p">}</span>
<span class="p">];</span>

<span class="kr">const</span> <span class="nx">state</span> <span class="o">=</span> <span class="nx">actions</span><span class="p">.</span><span class="nx">reduce</span><span class="p">(</span><span class="nx">reducer</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">);</span>
</pre></div>


<p>After this, <code>state</code> would look identical to our previous <code>state1</code>:</p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nx">nextNoteId</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
  <span class="nx">notes</span><span class="o">:</span> <span class="p">{</span>
    <span class="mi">1</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">id</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
      <span class="nx">content</span><span class="o">:</span> <span class="s1">&#39;Hello, world!&#39;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>Play around with adding actions to our <code>actions</code> array and feeding them into the reducer.</p>
<iframe width="100%" height="300" src="https://jsfiddle.net/justindeal/edogdh33/embedded/js,result/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>

<p>Now you can understand why Redux bills itself as "a predictable state container for JavaScript apps". Feed in the same set of actions, and you'll end up in the same state. Functional programming for the win! If you hear about Redux facilitating replay, this is roughly how that works. Out of the box though, Redux doesn't hold onto a list of actions. Instead, there's a single variable that points to the state object, and we keep changing that variable to point to the next state. That is one important mutation that <em>is</em> allowed in your app, but we'll control that mutation inside a store.</p>
<h2>The Store</h2>
<p>Let's build a store now, which will hold onto our single state variable as well as some useful methods for setting and getting the state.</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">validateAction</span> <span class="o">=</span> <span class="nx">action</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">action</span> <span class="o">||</span> <span class="k">typeof</span> <span class="nx">action</span> <span class="o">!==</span> <span class="s1">&#39;object&#39;</span> <span class="o">||</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">action</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Action must be an object!&#39;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">action</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Action must have a type!&#39;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="kr">const</span> <span class="nx">createStore</span> <span class="o">=</span> <span class="p">(</span><span class="nx">reducer</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">state</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">dispatch</span><span class="o">:</span> <span class="p">(</span><span class="nx">action</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">validateAction</span><span class="p">(</span><span class="nx">action</span><span class="p">)</span>
      <span class="nx">state</span> <span class="o">=</span> <span class="nx">reducer</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">action</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">getState</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">state</span>
  <span class="p">};</span>
<span class="p">};</span>
</pre></div>


<p>Now you can see why we use constants instead of strings. Our action validation is a little looser than Redux's, but it's close enough to enforce that we don't misspell action types. If we pass along strings, then our action will just fall through to the default case of our reducer, and nothing much will happen, and the error may go unnoticed. But if we use constants, then typos will go through as <code>undefined</code>, which will throw an error. So we'll know right away and fix it.</p>
<p>Let's create a store now and use it.</p>
<div class="codehilite"><pre><span></span><span class="c1">// Pass in the reducer we made earlier.</span>
<span class="kr">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="nx">createStore</span><span class="p">(</span><span class="nx">reducer</span><span class="p">);</span>

<span class="nx">store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">({</span>
  <span class="nx">type</span><span class="o">:</span> <span class="nx">CREATE_NOTE</span>
<span class="p">});</span>

<span class="nx">store</span><span class="p">.</span><span class="nx">getState</span><span class="p">();</span>
<span class="c1">// {</span>
<span class="c1">//   nextNoteId: 2,</span>
<span class="c1">//   notes: {</span>
<span class="c1">//     1: {</span>
<span class="c1">//       id: 1,</span>
<span class="c1">//       content: &#39;&#39;</span>
<span class="c1">//     }</span>
<span class="c1">//   }</span>
<span class="c1">// }</span>
</pre></div>


<p>This is fairly functional at this point. We have a store that can use any reducer we provide to manage the state. But it's still missing an important bit: A way to subscribe to changes. Without that, it's going to require some awkward imperative code. And later when we introduce asynchronous actions, it's not going to work at all. So let's go ahead and implement subscriptions.</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">createStore</span> <span class="o">=</span> <span class="nx">reducer</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">state</span><span class="p">;</span>
  <span class="kr">const</span> <span class="nx">subscribers</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="kr">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">dispatch</span><span class="o">:</span> <span class="nx">action</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">validateAction</span><span class="p">(</span><span class="nx">action</span><span class="p">);</span>
      <span class="nx">state</span> <span class="o">=</span> <span class="nx">reducer</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">action</span><span class="p">);</span>
      <span class="nx">subscribers</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">handler</span> <span class="o">=&gt;</span> <span class="nx">handler</span><span class="p">());</span>
    <span class="p">},</span>
    <span class="nx">getState</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">state</span><span class="p">,</span>
    <span class="nx">subscribe</span><span class="o">:</span> <span class="nx">handler</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">subscribers</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">handler</span><span class="p">);</span>
      <span class="k">return</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">index</span> <span class="o">=</span> <span class="nx">subscribers</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">handler</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">index</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">subscribers</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">};</span>
    <span class="p">}</span>
  <span class="p">};</span>
  <span class="nx">store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">({</span><span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;@@redux/INIT&#39;</span><span class="p">});</span>
  <span class="k">return</span> <span class="nx">store</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>


<p>A little more code, but not <em>too</em> hard to follow. The <code>subscribe</code> function takes a <code>handler</code> function and adds that to the list of <code>subscribers</code>. It also returns a function to unsubscribe. Any time we call <code>dispatch</code>, we notify all those handlers. Now it's easy to re-render every time the state changes.</p>
<iframe width="100%" height="300" src="https://jsfiddle.net/justindeal/8cpu4ydj/3/embedded/js,result/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>

<p>Play with the code and dispatch more actions. The rendered HTML will always reflect the store state. Of course, for a real app, we want to wire up those <code>dispatch</code> functions to user actions. We'll get to that soon enough!</p>
<h2>Bring Your own Components</h2>
<p>How do you make components that work with Redux? Just make plain old React components that take props. You bring your own state, so make components that work with that state (or parts of it). There are some nuances that <em>might</em> affect your design later, particularly with respect to performance, but for the most part, boring components are a good place to start. So let's do that for our app now.</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">NoteEditor</span> <span class="o">=</span> <span class="p">({</span><span class="nx">note</span><span class="p">,</span> <span class="nx">onChangeNote</span><span class="p">,</span> <span class="nx">onCloseNote</span><span class="p">})</span> <span class="o">=&gt;</span> <span class="p">(</span>
  <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">textarea</span>
        <span class="nx">className</span><span class="o">=</span><span class="s2">&quot;editor-content&quot;</span>
        <span class="nx">autoFocus</span>
        <span class="nx">value</span><span class="o">=</span><span class="p">{</span><span class="nx">note</span><span class="p">.</span><span class="nx">content</span><span class="p">}</span>
        <span class="nx">onChange</span><span class="o">=</span><span class="p">{</span><span class="nx">event</span> <span class="o">=&gt;</span> <span class="nx">onChangeNote</span><span class="p">(</span><span class="nx">note</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">)}</span>
        <span class="nx">rows</span><span class="o">=</span><span class="p">{</span><span class="mi">10</span><span class="p">}</span> <span class="nx">cols</span><span class="o">=</span><span class="p">{</span><span class="mi">80</span><span class="p">}</span>
      <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>
    <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&quot;editor-button&quot;</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">onCloseNote</span><span class="p">}</span><span class="o">&gt;</span><span class="nx">Close</span><span class="o">&lt;</span><span class="err">/button&gt;</span>
  <span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="p">);</span>

<span class="kr">const</span> <span class="nx">NoteTitle</span> <span class="o">=</span> <span class="p">({</span><span class="nx">note</span><span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">title</span> <span class="o">=</span> <span class="nx">note</span><span class="p">.</span><span class="nx">content</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^\s+|\s+$/g</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">title</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">&lt;</span><span class="nx">i</span><span class="o">&gt;</span><span class="nx">Untitled</span><span class="o">&lt;</span><span class="err">/i&gt;;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="o">&lt;</span><span class="nx">span</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">title</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/span&gt;;</span>
<span class="p">};</span>

<span class="kr">const</span> <span class="nx">NoteLink</span> <span class="o">=</span> <span class="p">({</span><span class="nx">note</span><span class="p">,</span> <span class="nx">onOpenNote</span><span class="p">})</span> <span class="o">=&gt;</span> <span class="p">(</span>
  <span class="o">&lt;</span><span class="nx">li</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&quot;note-list-item&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="s2">&quot;#&quot;</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="nx">onOpenNote</span><span class="p">(</span><span class="nx">note</span><span class="p">.</span><span class="nx">id</span><span class="p">)}</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">NoteTitle</span> <span class="nx">note</span><span class="o">=</span><span class="p">{</span><span class="nx">note</span><span class="p">}</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="err">/a&gt;</span>
  <span class="o">&lt;</span><span class="err">/li&gt;</span>
<span class="p">);</span>

<span class="kr">const</span> <span class="nx">NoteList</span> <span class="o">=</span> <span class="p">({</span><span class="nx">notes</span><span class="p">,</span> <span class="nx">onOpenNote</span><span class="p">})</span> <span class="o">=&gt;</span> <span class="p">(</span>
  <span class="o">&lt;</span><span class="nx">ul</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&quot;note-list&quot;</span><span class="o">&gt;</span>
    <span class="p">{</span>
      <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">notes</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="nx">id</span> <span class="o">=&gt;</span>
        <span class="o">&lt;</span><span class="nx">NoteLink</span>
          <span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="nx">id</span><span class="p">}</span>
          <span class="nx">note</span><span class="o">=</span><span class="p">{</span><span class="nx">notes</span><span class="p">[</span><span class="nx">id</span><span class="p">]}</span>
          <span class="nx">onOpenNote</span><span class="o">=</span><span class="p">{</span><span class="nx">onOpenNote</span><span class="p">}</span>
        <span class="o">/&gt;</span>
      <span class="p">)</span>
    <span class="p">}</span>
  <span class="o">&lt;</span><span class="err">/ul&gt;</span>
<span class="p">);</span>

<span class="kr">const</span> <span class="nx">NoteApp</span> <span class="o">=</span> <span class="p">({</span>
  <span class="nx">notes</span><span class="p">,</span> <span class="nx">openNoteId</span><span class="p">,</span> <span class="nx">onAddNote</span><span class="p">,</span> <span class="nx">onChangeNote</span><span class="p">,</span>
  <span class="nx">onOpenNote</span><span class="p">,</span> <span class="nx">onCloseNote</span>
<span class="p">})</span> <span class="o">=&gt;</span> <span class="p">(</span>
  <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
    <span class="p">{</span>
      <span class="nx">openNoteId</span> <span class="o">?</span>
        <span class="o">&lt;</span><span class="nx">NoteEditor</span>
          <span class="nx">note</span><span class="o">=</span><span class="p">{</span><span class="nx">notes</span><span class="p">[</span><span class="nx">openNoteId</span><span class="p">]}</span> <span class="nx">onChangeNote</span><span class="o">=</span><span class="p">{</span><span class="nx">onChangeNote</span><span class="p">}</span>
          <span class="nx">onCloseNote</span><span class="o">=</span><span class="p">{</span><span class="nx">onCloseNote</span><span class="p">}</span>
        <span class="o">/&gt;</span> <span class="o">:</span>
        <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="nx">NoteList</span> <span class="nx">notes</span><span class="o">=</span><span class="p">{</span><span class="nx">notes</span><span class="p">}</span> <span class="nx">onOpenNote</span><span class="o">=</span><span class="p">{</span><span class="nx">onOpenNote</span><span class="p">}</span><span class="o">/&gt;</span>
          <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&quot;editor-button&quot;</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">onAddNote</span><span class="p">}</span><span class="o">&gt;</span><span class="nx">New</span> <span class="nx">Note</span><span class="o">&lt;</span><span class="err">/button&gt;</span>
        <span class="o">&lt;</span><span class="err">/div&gt;</span>
    <span class="p">}</span>
  <span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="p">);</span>
</pre></div>


<p>Not much to see there. We could feed props into these components and render them right now. But let's look at the <code>openNoteId</code> prop and those <code>onOpenNote</code> and <code>onCloseNote</code> callbacks. We'll need to decide where that state and those callbacks live. We could just use component state for that. And there's nothing wrong with that. Once you start using Redux, there's no rule that says <em>all</em> your state needs to go into the Redux store. If you want to know when you have to use store state, just ask yourself:</p>
<blockquote>
<p>Does this state need to exist after this component is unmounted?</p>
</blockquote>
<p>If the answer is no, there's a good chance component state is appropriate. For state that has to be persisted to the server or shared across many components that may independently mount and unmount, Redux is probably a better choice.</p>
<p>There are some times when Redux does work well for transient state though. In particular, when transient state needs to change as the result of changes to store state, it can be a little easier to just keep the transient state in the store. For our app, when we create a note, we want the <code>openNoteId</code> to be set to the new note id. This would be cumbersome to reflect inside component state, because we'd have to monitor for changes to the store state in <code>componentWillReceiveProps</code>. That's not to say it's wrong, just that it can be awkward. So for our app, we'll store <code>openNoteId</code> in our store state. (In a real app, we might want to involve a router for this. See <a href="index.html#routing">the end of this post</a> for a bit on that.)</p>
<p>The other reason you might want transient state in the store is simply to have access to it from Redux developer tools. It's really easy to peek into store state, and fancy things like replay will just work. It's pretty easy to start with local component state and switch to store state later, though. Just make sure to create container components for local state just like you would store state.</p>
<p>So, let's tweak our reducer to handle this transient state.</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">OPEN_NOTE</span> <span class="o">=</span> <span class="s1">&#39;OPEN_NOTE&#39;</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">CLOSE_NOTE</span> <span class="o">=</span> <span class="s1">&#39;CLOSE_NOTE&#39;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">initialState</span> <span class="o">=</span> <span class="p">{</span>
  <span class="c1">// ...</span>
  <span class="nx">openNoteId</span><span class="o">:</span> <span class="kc">null</span>
<span class="p">};</span>

<span class="kr">const</span> <span class="nx">reducer</span> <span class="o">=</span> <span class="p">(</span><span class="nx">state</span> <span class="o">=</span> <span class="nx">initialState</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">switch</span> <span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="nx">CREATE_NOTE</span><span class="o">:</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">state</span><span class="p">.</span><span class="nx">nextNoteId</span><span class="p">;</span>
      <span class="c1">// ...</span>
      <span class="k">return</span> <span class="p">{</span>
        <span class="p">...</span><span class="nx">state</span><span class="p">,</span>
        <span class="c1">// ...</span>
        <span class="nx">openNoteId</span><span class="o">:</span> <span class="nx">id</span><span class="p">,</span>
        <span class="c1">// ...</span>
      <span class="p">};</span>
    <span class="p">}</span>
    <span class="c1">// ...</span>
    <span class="k">case</span> <span class="nx">OPEN_NOTE</span><span class="o">:</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">{</span>
        <span class="p">...</span><span class="nx">state</span><span class="p">,</span>
        <span class="nx">openNoteId</span><span class="o">:</span> <span class="nx">action</span><span class="p">.</span><span class="nx">id</span>
      <span class="p">};</span>
    <span class="p">}</span>
    <span class="k">case</span> <span class="nx">CLOSE_NOTE</span><span class="o">:</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">{</span>
        <span class="p">...</span><span class="nx">state</span><span class="p">,</span>
        <span class="nx">openNoteId</span><span class="o">:</span> <span class="kc">null</span>
      <span class="p">};</span>
    <span class="p">}</span>
    <span class="k">default</span><span class="o">:</span>
      <span class="k">return</span> <span class="nx">state</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>
</pre></div>


<h2>Wire Things up, the Manual Way</h2>
<p>Okay, now we can wire this thing up. We won't touch our existing components for this. Instead, we'll create a new container component that gets the state from the store and passes it along to our <code>NoteApp</code>.</p>
<div class="codehilite"><pre><span></span><span class="kr">class</span> <span class="nx">NoteAppContainer</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">super</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="nx">props</span><span class="p">.</span><span class="nx">store</span><span class="p">.</span><span class="nx">getState</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">onAddNote</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">onAddNote</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">onChangeNote</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">onChangeNote</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">onOpenNote</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">onOpenNote</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">onCloseNote</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">onCloseNote</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="nx">componentWillMount</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">unsubscribe</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">store</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(()</span> <span class="o">=&gt;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">store</span><span class="p">.</span><span class="nx">getState</span><span class="p">())</span>
    <span class="p">);</span>
  <span class="p">}</span>
  <span class="nx">componentWillUnmount</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">unsubscribe</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="nx">onAddNote</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">({</span>
      <span class="nx">type</span><span class="o">:</span> <span class="nx">CREATE_NOTE</span>
    <span class="p">});</span>
  <span class="p">}</span>
  <span class="nx">onChangeNote</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">content</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">({</span>
      <span class="nx">type</span><span class="o">:</span> <span class="nx">UPDATE_NOTE</span><span class="p">,</span>
      <span class="nx">id</span><span class="p">,</span>
      <span class="nx">content</span>
    <span class="p">});</span>
  <span class="p">}</span>
  <span class="nx">onOpenNote</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">({</span>
      <span class="nx">type</span><span class="o">:</span> <span class="nx">OPEN_NOTE</span><span class="p">,</span>
      <span class="nx">id</span>
    <span class="p">});</span>
  <span class="p">}</span>
  <span class="nx">onCloseNote</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">({</span>
      <span class="nx">type</span><span class="o">:</span> <span class="nx">CLOSE_NOTE</span>
    <span class="p">});</span>
  <span class="p">}</span>
  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">NoteApp</span>
        <span class="p">{...</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">}</span>
        <span class="nx">onAddNote</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">onAddNote</span><span class="p">}</span>
        <span class="nx">onChangeNote</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">onChangeNote</span><span class="p">}</span>
        <span class="nx">onOpenNote</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">onOpenNote</span><span class="p">}</span>
        <span class="nx">onCloseNote</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">onCloseNote</span><span class="p">}</span>
      <span class="o">/&gt;</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span>
  <span class="o">&lt;</span><span class="nx">NoteAppContainer</span> <span class="nx">store</span><span class="o">=</span><span class="p">{</span><span class="nx">store</span><span class="p">}</span><span class="o">/&gt;</span><span class="p">,</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;root&#39;</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>


<p>Yay, it's alive! Try it out!</p>
<iframe width="100%" height="300" src="https://jsfiddle.net/justindeal/8bL9tL0z/1/embedded/js,result/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>

<p>Our app is dispatching actions, which update the store state via our reducer, and our subscription is keeping our view in sync. If we end up in a weird state, we don't have to peek into all of our componentswe just look at our reducer and actions.</p>
<h2>Provider and Connect</h2>
<p>Okay, so everything is working. But&hellip; there are some problems.</p>
<ol>
<li>Wiring feels imperative.</li>
<li>There's a lot of repetition within our container component.</li>
<li>Every time we want to wire the store to a component, we're going to have to use a global <code>store</code> object. Or we're going to have to pass a <code>store</code> prop through the entire tree. Or we're going to have to wire it up once at the top and pass <em>everything</em> down through the tree, which might not be so great in a big app.</li>
</ol>
<p>This is why we need <code>Provider</code> and <code>connect</code> from React Redux. First, let's make a <code>Provider</code> component.</p>
<div class="codehilite"><pre><span></span><span class="kr">class</span> <span class="nx">Provider</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">getChildContext</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="nx">store</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">store</span>
    <span class="p">};</span>
  <span class="p">}</span>
  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">children</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">Provider</span><span class="p">.</span><span class="nx">childContextTypes</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">store</span><span class="o">:</span> <span class="nx">PropTypes</span><span class="p">.</span><span class="nx">object</span>
<span class="p">};</span>
</pre></div>


<p>Pretty simple. The <code>Provider</code> component uses React's <a href="https://facebook.github.io/react/docs/context.html">context feature</a> to convert a <code>store</code> prop into a context property. Context is a way to pass information from a top-level component down to descendant components without components in the middle having to explicitly pass props. In general, you should avoid context, because the <a href="https://facebook.github.io/react/docs/context.html#why-not-to-use-context">React documentation</a> says so:</p>
<blockquote>
<p>If you want your application to be stable, don't use context. It is an experimental API and it is likely to break in future releases of React.</p>
</blockquote>
<p>And that's why our implementation won't require anyone to use context directly. Instead, we're wrapping up that experimental API inside components so if it does change, we can change our implementation without requiring developers to change their code.</p>
<p>So now we need a way to convert context back into props. That's where <code>connect</code> comes in.</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">connect</span> <span class="o">=</span> <span class="p">(</span>
  <span class="nx">mapStateToProps</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">({}),</span>
  <span class="nx">mapDispatchToProps</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">({})</span>
<span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">Component</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kr">class</span> <span class="nx">Connected</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
    <span class="nx">onStoreOrPropsChange</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="p">{</span><span class="nx">store</span><span class="p">}</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">context</span><span class="p">;</span>
      <span class="kr">const</span> <span class="nx">state</span> <span class="o">=</span> <span class="nx">store</span><span class="p">.</span><span class="nx">getState</span><span class="p">();</span>
      <span class="kr">const</span> <span class="nx">stateProps</span> <span class="o">=</span> <span class="nx">mapStateToProps</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">props</span><span class="p">);</span>
      <span class="kr">const</span> <span class="nx">dispatchProps</span> <span class="o">=</span> <span class="nx">mapDispatchToProps</span><span class="p">(</span><span class="nx">store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">,</span> <span class="nx">props</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
        <span class="p">...</span><span class="nx">stateProps</span><span class="p">,</span>
        <span class="p">...</span><span class="nx">dispatchProps</span>
      <span class="p">});</span>
    <span class="p">}</span>
    <span class="nx">componentWillMount</span><span class="p">()</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="p">{</span><span class="nx">store</span><span class="p">}</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">context</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">onStoreOrPropsChange</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">unsubscribe</span> <span class="o">=</span> <span class="nx">store</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">onStoreOrPropsChange</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="nx">componentWillReceiveProps</span><span class="p">(</span><span class="nx">nextProps</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">onStoreOrPropsChange</span><span class="p">(</span><span class="nx">nextProps</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">componentWillUnmount</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">unsubscribe</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="o">&lt;</span><span class="nx">Component</span> <span class="p">{...</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">}</span> <span class="p">{...</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">}</span><span class="o">/&gt;</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">Connected</span><span class="p">.</span><span class="nx">contextTypes</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">store</span><span class="o">:</span> <span class="nx">PropTypes</span><span class="p">.</span><span class="nx">object</span>
  <span class="p">};</span>

  <span class="k">return</span> <span class="nx">Connected</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>That one is a little more complicated. And truth be told, we've cheated <em>a lot</em> compared to the actual implementation. (We'll discuss that a little <a href="index.html#performance">at the end</a>.) But this is close enough to get the idea. <code>connect</code> is a <a href="https://facebook.github.io/react/docs/higher-order-components.html">higher-order component</a>. Well, actually, it's more of a higher order component factory. It takes two functions and returns a function that takes a component and returns a new component. That component subscribes to the store and updates your component's props when there are changes. Let's use it, and it will make more sense.</p>
<h2>Wire Things up the Automatic Way</h2>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">mapStateToProps</span> <span class="o">=</span> <span class="nx">state</span> <span class="o">=&gt;</span> <span class="p">({</span>
  <span class="nx">notes</span><span class="o">:</span> <span class="nx">state</span><span class="p">.</span><span class="nx">notes</span><span class="p">,</span>
  <span class="nx">openNoteId</span><span class="o">:</span> <span class="nx">state</span><span class="p">.</span><span class="nx">openNoteId</span>
<span class="p">});</span>

<span class="kr">const</span> <span class="nx">mapDispatchToProps</span> <span class="o">=</span> <span class="nx">dispatch</span> <span class="o">=&gt;</span> <span class="p">({</span>
  <span class="nx">onAddNote</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">dispatch</span><span class="p">({</span>
    <span class="nx">type</span><span class="o">:</span> <span class="nx">CREATE_NOTE</span>
  <span class="p">}),</span>
  <span class="nx">onChangeNote</span><span class="o">:</span> <span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">content</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">dispatch</span><span class="p">({</span>
    <span class="nx">type</span><span class="o">:</span> <span class="nx">UPDATE_NOTE</span><span class="p">,</span>
    <span class="nx">id</span><span class="p">,</span>
    <span class="nx">content</span>
  <span class="p">}),</span>
  <span class="nx">onOpenNote</span><span class="o">:</span> <span class="nx">id</span> <span class="o">=&gt;</span> <span class="nx">dispatch</span><span class="p">({</span>
    <span class="nx">type</span><span class="o">:</span> <span class="nx">OPEN_NOTE</span><span class="p">,</span>
    <span class="nx">id</span>
  <span class="p">}),</span>
  <span class="nx">onCloseNote</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">dispatch</span><span class="p">({</span>
    <span class="nx">type</span><span class="o">:</span> <span class="nx">CLOSE_NOTE</span>
  <span class="p">})</span>
<span class="p">});</span>

<span class="kr">const</span> <span class="nx">NoteAppContainer</span> <span class="o">=</span> <span class="nx">connect</span><span class="p">(</span>
  <span class="nx">mapStateToProps</span><span class="p">,</span>
  <span class="nx">mapDispatchToProps</span>
<span class="p">)(</span><span class="nx">NoteApp</span><span class="p">);</span>
</pre></div>


<p>Hey, that looks nicer!</p>
<p>The first function passed to <code>connect</code> (<code>mapStateToProps</code>) takes the current <code>state</code> from our <code>store</code> and returns some props. The second function passed to <code>connect</code> (<code>mapDispatchToProps</code>) takes the <code>dispatch</code> method of our <code>store</code> and returns some more props. That gives us back a new function, and we pass our component to that function. That gives us a new component, which will automatically get all those mapped props (plus any extra ones we pass in).</p>
<p>Now we just need to use our <code>Provider</code> component so <code>connect</code> can get the <code>store</code> off of the <code>context</code>.</p>
<div class="codehilite"><pre><span></span><span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span>
  <span class="o">&lt;</span><span class="nx">Provider</span> <span class="nx">store</span><span class="o">=</span><span class="p">{</span><span class="nx">store</span><span class="p">}</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">NoteAppContainer</span><span class="o">/&gt;</span>
  <span class="o">&lt;</span><span class="err">/Provider&gt;,</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;root&#39;</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>


<p>Nice! Our <code>store</code> is passed in once at the top, and <code>connect</code> picks it up and does all the work. Declarative for the win! Here's our app again cleaned up with <code>Provider</code> and <code>connect</code>:</p>
<iframe width="100%" height="300" src="https://jsfiddle.net/justindeal/srnf5n20/3/embedded/js,result/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>

<h2>Middleware</h2>
<p>So, we've built something pretty useful now. But there's a big missing piece. At some point we're going to want to talk to a server. And our actions are synchronous. How do we do <em>asynchronous</em> actions? Well, we could fetch data in our components, but there are some problems with that.</p>
<ol>
<li>Redux (aside from <code>Provider</code> and <code>connect</code>) isn't meant to be React specific. It would be nice to have a Redux solution.</li>
<li>We sometimes need access to the state when fetching data. We don't want to pass around that state everywhere. So we'd end up having to build something like <code>connect</code> for data fetching.</li>
<li>We won't be able to test state changes that involve data fetching without involving our components. If we can keep data fetching separate, we probably should.</li>
<li>Once again, we'll lose out on some tooling benefits.</li>
</ol>
<p>Since Redux is synchronous, how is this going to work? By putting something in the middle of your dispatches and changes to the store state. That something is middleware.</p>
<p>We need a way to pass middleware into our store, so let's do that.</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">createStore</span> <span class="o">=</span> <span class="p">(</span><span class="nx">reducer</span><span class="p">,</span> <span class="nx">middleware</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">state</span><span class="p">;</span>
  <span class="kr">const</span> <span class="nx">subscribers</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="kr">const</span> <span class="nx">coreDispatch</span> <span class="o">=</span> <span class="nx">action</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">validateAction</span><span class="p">(</span><span class="nx">action</span><span class="p">);</span>
    <span class="nx">state</span> <span class="o">=</span> <span class="nx">reducer</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">action</span><span class="p">);</span>
    <span class="nx">subscribers</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">handler</span> <span class="o">=&gt;</span> <span class="nx">handler</span><span class="p">());</span>
  <span class="p">};</span>
  <span class="kr">const</span> <span class="nx">getState</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">state</span><span class="p">;</span>
  <span class="kr">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">dispatch</span><span class="o">:</span> <span class="nx">coreDispatch</span><span class="p">,</span>
    <span class="nx">getState</span><span class="p">,</span>
    <span class="nx">subscribe</span><span class="o">:</span> <span class="nx">handler</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">subscribers</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">handler</span><span class="p">);</span>
      <span class="k">return</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">index</span> <span class="o">=</span> <span class="nx">subscribers</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">handler</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">index</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">subscribers</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">};</span>
    <span class="p">}</span>
  <span class="p">};</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">middleware</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">dispatch</span> <span class="o">=</span> <span class="nx">action</span> <span class="o">=&gt;</span> <span class="nx">store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">action</span><span class="p">);</span>
    <span class="nx">store</span><span class="p">.</span><span class="nx">dispatch</span> <span class="o">=</span> <span class="nx">middleware</span><span class="p">({</span>
      <span class="nx">dispatch</span><span class="p">,</span>
      <span class="nx">getState</span>
    <span class="p">})(</span><span class="nx">coreDispatch</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="nx">coreDispatch</span><span class="p">({</span><span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;@@redux/INIT&#39;</span><span class="p">});</span>
  <span class="k">return</span> <span class="nx">store</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>Things are a little more complicated now, but the important part is that last <code>if</code> statement:</p>
<div class="codehilite"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">middleware</span><span class="p">)</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">dispatch</span> <span class="o">=</span> <span class="nx">action</span> <span class="o">=&gt;</span> <span class="nx">store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">action</span><span class="p">);</span>
  <span class="nx">store</span><span class="p">.</span><span class="nx">dispatch</span> <span class="o">=</span> <span class="nx">middleware</span><span class="p">({</span>
    <span class="nx">dispatch</span><span class="p">,</span>
    <span class="nx">getState</span>
  <span class="p">})(</span><span class="nx">coreDispatch</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>


<p>We make a function that will "re-dispatch".</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">dispatch</span> <span class="o">=</span> <span class="nx">action</span> <span class="o">=&gt;</span> <span class="nx">store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">action</span><span class="p">);</span>
</pre></div>


<p>That's so if a middleware decides to dispatch a new action, that new action goes back through the middleware. We have to create this function because we're about to change the store's <code>dispatch</code> function. This is another place where mutation makes things easier. Redux can break the rules as long as it helps you enforce them. :-)</p>
<div class="codehilite"><pre><span></span><span class="nx">store</span><span class="p">.</span><span class="nx">dispatch</span> <span class="o">=</span> <span class="nx">middleware</span><span class="p">({</span>
  <span class="nx">dispatch</span><span class="p">,</span>
  <span class="nx">getState</span>
<span class="p">})(</span><span class="nx">coreDispatch</span><span class="p">);</span>
</pre></div>


<p>That calls the middleware, passing it an object that has access to our re-dispatch function as well as our <code>getState</code> function. The middleware should return a new function that accepts the ability to call the next dispatch function, which in this case is just the original dispatch function. If your head is spinning a little, don't worry, creating and using middleware is actually pretty easy.</p>
<p>Okay, let's create a piece of middleware that delays dispatch for a second. Pretty useless, but it will illustrate async.</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">delayMiddleware</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">next</span> <span class="o">=&gt;</span> <span class="nx">action</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">next</span><span class="p">(</span><span class="nx">action</span><span class="p">);</span>
  <span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>


<p>That signature looks super goofy, but it fits into the puzzle we created before. It's a function that returns a function that takes the next dispatch function. That function takes the action. Okay, it may seem like Redux went arrow function crazy here, but there's a reason, which we'll point out soon.</p>
<p>Now, let's use that middleware for our store.</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="nx">createStore</span><span class="p">(</span><span class="nx">reducer</span><span class="p">,</span> <span class="nx">delayMiddleware</span><span class="p">);</span>
</pre></div>


<p>Yay, we made our app slower! Wait, no, boo! But we have async now. Yay! Experience this terrible app for yourself. Typing is particularly humorous.</p>
<iframe width="100%" height="300" src="https://jsfiddle.net/justindeal/56uf0uy7/3/embedded/js,result/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>

<p>Play with the <code>setTimeout</code> time to make it more or less terrible.</p>
<h2>Composing Middleware Together</h2>
<p>Now let's make another (more useful) middleware for logging.</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">loggingMiddleware</span> <span class="o">=</span> <span class="p">({</span><span class="nx">getState</span><span class="p">})</span> <span class="o">=&gt;</span> <span class="nx">next</span> <span class="o">=&gt;</span> <span class="nx">action</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="s1">&#39;before&#39;</span><span class="p">,</span> <span class="nx">getState</span><span class="p">());</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="s1">&#39;action&#39;</span><span class="p">,</span> <span class="nx">action</span><span class="p">);</span>
  <span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">next</span><span class="p">(</span><span class="nx">action</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="s1">&#39;after&#39;</span><span class="p">,</span> <span class="nx">getState</span><span class="p">());</span>
  <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>


<p>Hey, that's useful. Let's add that to our store. Hmm, our store only takes one middleware function. No problem! We just need a way to compose our middleware together. So, let's make a way to turn lots of middleware functions into one middleware function. Let's build <code>applyMiddleware</code>!</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">applyMiddleware</span> <span class="o">=</span> <span class="p">(...</span><span class="nx">middlewares</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">store</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">middlewares</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">dispatch</span> <span class="o">=&gt;</span> <span class="nx">dispatch</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">middlewares</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">middlewares</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
  <span class="p">}</span>
  <span class="kr">const</span> <span class="nx">boundMiddlewares</span> <span class="o">=</span> <span class="nx">middlewares</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">middleware</span> <span class="o">=&gt;</span>
    <span class="nx">middleware</span><span class="p">(</span><span class="nx">store</span><span class="p">);</span>
  <span class="p">);</span>
  <span class="k">return</span> <span class="nx">boundMiddlewares</span><span class="p">.</span><span class="nx">reduce</span><span class="p">((</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="o">=&gt;</span>
    <span class="nx">next</span> <span class="o">=&gt;</span> <span class="nx">a</span><span class="p">(</span><span class="nx">b</span><span class="p">(</span><span class="nx">next</span><span class="p">));</span>
  <span class="p">);</span>
<span class="p">};</span>
</pre></div>


<p>That's a funky function, but hopefully you can kind of follow along. First thing to notice is it takes a list of middlewares and returns a middleware function. (Not sure if middlewares is a word, but it comes in handy here.) That new middleware function has the same signature as our earlier middleware. It takes a store (really just our re-<code>dispatch</code> and <code>getState</code> methods, not really the whole store) and returns another function. For that function:</p>
<ol>
<li>If we have no middleware, we return an identity function. Basically, just a no-op middleware. This is silly, but we're just keeping people from breaking things.</li>
<li>If we have one middleware function, we return that middleware function. Again, silly, we're just carrying somebody's groceries here.</li>
<li>We bind all the middleware to our pseudo-store. Okay, finally something interesting.</li>
<li>We bind each of those functions to the next dispatch function. This is why our middleware has to be arrows all the way down. We're left with a function that will take an action and is able to keep calling the next dispatch function until it finally reaches the original dispatch function.</li>
</ol>
<p>Phew! Okay, now we can use all the middleware we want.</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="nx">createStore</span><span class="p">(</span><span class="nx">reducer</span><span class="p">,</span> <span class="nx">applyMiddleware</span><span class="p">(</span>
  <span class="nx">delayMiddleware</span><span class="p">,</span>
  <span class="nx">loggingMiddleware</span>
<span class="p">));</span>
</pre></div>


<p>Yay! Now our Redux implementation can handle all the things!</p>
<iframe width="100%" height="300" src="https://jsfiddle.net/justindeal/3ukd4mL7/3/embedded/js,result/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>

<p>Open the console in your browser to see the logging middleware at work.</p>
<h2>Thunk middleware</h2>
<p>Let's really do some async now. To do that we'll introduce a "thunk" middleware:</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">thunkMiddleware</span> <span class="o">=</span> <span class="p">({</span><span class="nx">dispatch</span><span class="p">,</span> <span class="nx">getState</span><span class="p">})</span> <span class="o">=&gt;</span> <span class="nx">next</span> <span class="o">=&gt;</span> <span class="nx">action</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">action</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">action</span><span class="p">({</span><span class="nx">dispatch</span><span class="p">,</span> <span class="nx">getState</span><span class="p">});</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">action</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>


<p>"Thunk" is really just another name for "function", but it typically means "a function that is wrapping some work to be done later". If we add in <code>thunkMiddleware</code>:</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="nx">createStore</span><span class="p">(</span><span class="nx">reducer</span><span class="p">,</span> <span class="nx">applyMiddleware</span><span class="p">(</span>
  <span class="nx">thunkMiddleware</span><span class="p">,</span>
  <span class="nx">loggingMiddleware</span>
<span class="p">));</span>
</pre></div>


<p>Now we can do something like this:</p>
<div class="codehilite"><pre><span></span><span class="nx">store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(({</span><span class="nx">getState</span><span class="p">,</span> <span class="nx">dispatch</span><span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// Grab something from the state</span>
  <span class="kr">const</span> <span class="nx">someId</span> <span class="o">=</span> <span class="nx">getState</span><span class="p">().</span><span class="nx">someId</span><span class="p">;</span>
  <span class="c1">// Fetch something that depends on knowing that something</span>
  <span class="nx">fetchSomething</span><span class="p">(</span><span class="nx">someId</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">something</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="c1">// Dispatch whenever we feel like it</span>
      <span class="nx">dispatch</span><span class="p">({</span>
        <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;someAction&#39;</span><span class="p">,</span>
        <span class="nx">something</span>
      <span class="p">});</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></div>


<p>The thunk middleware is a big hammer. We can pull anything we want out of state, and we can dispatch any action we want at any time. This is really flexible, but as your app grows, it <em>may</em> become a little dangerous. It's a good place to start though. Let's use it to do some async work.</p>
<p>First, let's create a fake API.</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">createFakeApi</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">_id</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kr">const</span> <span class="nx">createNote</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">(</span><span class="nx">resolve</span> <span class="o">=&gt;</span> <span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">_id</span><span class="o">++</span>
    <span class="nx">resolve</span><span class="p">({</span>
      <span class="nx">id</span><span class="o">:</span> <span class="sb">`</span><span class="si">${</span><span class="nx">_id</span><span class="si">}</span><span class="sb">`</span>
    <span class="p">})</span>
  <span class="p">},</span> <span class="mi">1000</span><span class="p">));</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">createNote</span>
  <span class="p">};</span>
<span class="p">};</span>

<span class="kr">const</span> <span class="nx">api</span> <span class="o">=</span> <span class="nx">createFakeApi</span><span class="p">()</span>
</pre></div>


<p>This API only supports one method to create a note and returns the new id for that note. Since we're now getting the id from the server, we'll want to tweak our reducer again.</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">initialState</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">notes</span><span class="o">:</span> <span class="p">{},</span>
  <span class="nx">openNoteId</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="nx">isLoading</span><span class="o">:</span> <span class="kc">false</span>
<span class="p">};</span>

<span class="kr">const</span> <span class="nx">reducer</span> <span class="o">=</span> <span class="p">(</span><span class="nx">state</span> <span class="o">=</span> <span class="nx">initialState</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">switch</span> <span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="nx">CREATE_NOTE</span><span class="o">:</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">action</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">{</span>
          <span class="p">...</span><span class="nx">state</span><span class="p">,</span>
          <span class="nx">isLoading</span><span class="o">:</span> <span class="kc">true</span>
        <span class="p">};</span>
      <span class="p">}</span>
      <span class="kr">const</span> <span class="nx">newNote</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">id</span><span class="o">:</span> <span class="nx">action</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
        <span class="nx">content</span><span class="o">:</span> <span class="s1">&#39;&#39;</span>
      <span class="p">};</span>
      <span class="k">return</span> <span class="p">{</span>
        <span class="p">...</span><span class="nx">state</span><span class="p">,</span>
        <span class="nx">isLoading</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="nx">openNoteId</span><span class="o">:</span> <span class="nx">action</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
        <span class="nx">notes</span><span class="o">:</span> <span class="p">{</span>
          <span class="p">...</span><span class="nx">state</span><span class="p">.</span><span class="nx">notes</span><span class="p">,</span>
          <span class="p">[</span><span class="nx">action</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span><span class="o">:</span> <span class="nx">newNote</span>
        <span class="p">}</span>
      <span class="p">};</span>
    <span class="p">}</span>
    <span class="c1">// ...</span>
  <span class="p">}</span>
<span class="p">};</span>
</pre></div>


<p>Here, we're using the <code>CREATE_NOTE</code> action to set the loading state and for actually creating the note in the store. We just use the presence or absence of the <code>id</code> property to signal the difference. You may want to use different actions for your app, but once again, Redux doesn't really care what you use. If you want something prescriptive, you can look at <a href="https://github.com/acdlite/flux-standard-action">Flux Standard Actions</a>.</p>
<p>Now let's tweak our <code>mapDispatchToProps</code> to dispatch a thunk.</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">mapDispatchToProps</span> <span class="o">=</span> <span class="nx">dispatch</span> <span class="o">=&gt;</span> <span class="p">({</span>
  <span class="nx">onAddNote</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">dispatch</span><span class="p">(</span>
    <span class="p">({</span><span class="nx">dispatch</span><span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">dispatch</span><span class="p">({</span>
        <span class="nx">type</span><span class="o">:</span> <span class="nx">CREATE_NOTE</span>
      <span class="p">});</span>
      <span class="nx">api</span><span class="p">.</span><span class="nx">createNote</span><span class="p">()</span>
        <span class="p">.</span><span class="nx">then</span><span class="p">(({</span><span class="nx">id</span><span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
          <span class="nx">dispatch</span><span class="p">({</span>
            <span class="nx">type</span><span class="o">:</span> <span class="nx">CREATE_NOTE</span><span class="p">,</span>
            <span class="nx">id</span>
          <span class="p">});</span>
        <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">),</span>
  <span class="c1">// ...</span>
<span class="p">});</span>
</pre></div>


<p>Our app is doing async work now!</p>
<iframe width="100%" height="300" src="https://jsfiddle.net/justindeal/o27j5zs1/1/embedded/js,result/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>

<p>But wait&hellip; besides that being some ugly code we dumped in our component, we invented middleware to try to get that out of our code. And now we put it right back in. If we made some custom api middleware instead of using the thunk hammer, we could get rid of that. But even when using thunk middleware, we can still make things more declarative.</p>
<h2>Action Creators</h2>
<p>Instead of dispatching the thunk from our component, let's abstract it away by putting it inside a function.</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">createNote</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">({</span><span class="nx">dispatch</span><span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">dispatch</span><span class="p">({</span>
      <span class="nx">type</span><span class="o">:</span> <span class="nx">CREATE_NOTE</span>
    <span class="p">});</span>
    <span class="nx">api</span><span class="p">.</span><span class="nx">createNote</span><span class="p">()</span>
      <span class="p">.</span><span class="nx">then</span><span class="p">(({</span><span class="nx">id</span><span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">dispatch</span><span class="p">({</span>
          <span class="nx">type</span><span class="o">:</span> <span class="nx">CREATE_NOTE</span><span class="p">,</span>
          <span class="nx">id</span>
        <span class="p">})</span>
      <span class="p">});</span>
  <span class="p">}</span>
<span class="p">};</span>
</pre></div>


<p>We just invented an action creator. Action creators are nothing fancy. They're just functions that return actions to be dispatched. They help to:</p>
<ol>
<li>Abstract away ugly actions like our new thunk action.</li>
<li>They help DRY up your code, if you're dispatching the same action from multiple components.</li>
<li>They let us move our action creating code away from our components, so our components stay simple and declarative.</li>
</ol>
<p>We could have introduced action creators earlier, but there really was no reason. Our app was simple, so we weren't repeating any of the same actions. And our actions were simple, so they were already pretty concise and declarative.</p>
<p>Let's tweak our <code>mapDispatchToProps</code> again to use our action creator.</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">mapDispatchToProps</span> <span class="o">=</span> <span class="nx">dispatch</span> <span class="o">=&gt;</span> <span class="p">({</span>
  <span class="nx">onAddNote</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">dispatch</span><span class="p">(</span><span class="nx">createNote</span><span class="p">()),</span>
  <span class="c1">// ...</span>
<span class="p">});</span>
</pre></div>


<p>Much better! Here's our final app:</p>
<iframe width="100%" height="300" src="https://jsfiddle.net/justindeal/5j3can1z/4/embedded/js,result/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>

<h2>That's About it!</h2>
<p>You built yourself a Redux! It might seem like we wrote a lot of code, but most of that was our reducer and components. Our actual Redux implementation is pretty tiny at less than <a href="https://gist.githubusercontent.com/jdeal/c224026df3bae5803fd9e58cbbd4a60b/raw/623150cb62a7076e78904881b61d4c948639abe8/mini-redux.js">140 lines</a>. And that includes our thunk and logging middleware, blank lines, and some comments!</p>
<p>Yes, there's a little more to the real Redux and to making a real app. Keep reading, and we'll talk about a few of those things. But if you find yourself in a rabbit hole with Redux, hopefully this guide has shined a little light!</p>
<h2>Some things we left out</h2>
<p><a id="performance"></a></p>
<h3>Performance</h3>
<p>One thing our implementation is sorely lacking is any concern over whether our selected props have actually changed. For our example app, it doesn't actually matter, because every state change also causes our props to change. But for a larger app with many different <code>mapStateToProps</code> functions, we only want components to update when they actually have new props. It's pretty easy to extend our <code>connect</code> function to do this. We just need to compare the previous mapping to the next mapping before we call <code>setState</code>. We do have to be smarter about <code>mapDispatchToProps</code> though. Notice we're creating new functions every time. The actual React Redux implementation detects the arity of that function to see if it depends on <code>props</code>. That way it doesn't have to do another mapping if the props haven't actually changed.</p>
<p>You'll also notice that we call our function when props change or when the store state changes. Those might both happen simultaneously, so we'll waste some effort. React Redux optimizes for this and many other things.</p>
<p>Beyond that, for larger apps, we have to start thinking about performance of any selectors. For example, if we filter a subset of notes, we don't want to keep recalculating that filtered list. For this, we have to reach for something like <a href="https://github.com/reactjs/reselect">reselect</a> or other memoization techniques.</p>
<h3>Freezing the State</h3>
<p>If you use plain JS data (and not something like Immutable.js), then one important detail I left out is freezing the reducer state in development. Because this is JavaScript, nothing is stopping you from mutating the state once you get it from the store. You could mutate it in a <code>render</code> method or wherever. This leads to very bad things and ruins some of the predictability you're trying to add with Redux. At Zapier, we do something like this:</p>
<div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="nx">deepFreeze</span> <span class="nx">from</span> <span class="s1">&#39;deep-freeze&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">reducer</span> <span class="nx">from</span> <span class="s1">&#39;your-reducer&#39;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">frozenReducer</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NODE_ENV</span> <span class="o">===</span> <span class="s1">&#39;production&#39;</span> <span class="o">?</span> <span class="nx">reducer</span> <span class="o">:</span> <span class="p">(</span>
  <span class="p">(...</span><span class="nx">args</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">state</span> <span class="o">=</span> <span class="nx">reducer</span><span class="p">(...</span><span class="nx">args</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">freezeState</span><span class="p">(</span><span class="nx">state</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">);</span>
</pre></div>


<p>This creates a reducer that freezes its results. This way, if you try to mutate the store state in a component, it will throw errors (in development). After a while, you'll train yourself to avoid making these mistakes. But if you're new to immutable data, this is probably one of the easiest ways to train yourself (and the rest of your team) to stop mutating.</p>
<h3>Server Rendering</h3>
<p>Besides performance, we also cheated on our <code>connect</code> implementation with respect to server rendering. <code>componentWillMount</code> gets called on the server, but we don't want to set up subscriptions on the server. Redux uses <code>componentDidMount</code> along with some trickery to make it properly work in a browser.</p>
<h3>Store Enhancers</h3>
<p>As if we didn't have enough higher order functions, Redux has another one we left out. A "store enhancer" is a higher order function that takes a store creator and returns an "enhanced" store creator. This is not a common thing to need to do, but it is used to create things like the Redux developer tools. The <a href="https://github.com/reactjs/redux/blob/4d8700c9631b152f0dff384d528a6c7f74024418/src/applyMiddleware.js"><em>real</em> implementation</a> of <code>applyMidleware</code> is actually a store enhancer.</p>
<h3>Tests</h3>
<p>There are no tests for our implementation. In general, don't actually use this implementation for anything real! It was written just for funsies for this blog post!</p>
<h3>Ordering</h3>
<p>We stored our notes in an object that just so happens to have numeric keys. That means every JS engine will order those in the order they were created. If instead our server returns GUIDs or some other unordered keys, we'll get crazy ordering. We don't want to store our notes in an array though, because then we can't easily pick out a note by id. So for a real app, we might want to store an array of ordered ids. Alternatively, we <em>might</em> be able to get by with an array if we use <code>reselect</code> to memoize the <code>find</code> operation.</p>
<h3>Side Effects from Action Creators</h3>
<p>At some point, you may be tempted to create some middleware that works with promises like this:</p>
<div class="codehilite"><pre><span></span><span class="nx">store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;/something&#39;</span><span class="p">));</span>
</pre></div>


<p>Don't do that. A function that returns a promise has already started doing the work. (Unless it's a weird lazy promise, which is not a normal promise.) That means we've prevented ourselves from building any middleware around this action. We can't create a smart throttling middleware for example. We also can't properly do replay, because replay needs to turn off dispatching. But any code calling this <code>dispatch</code> has already done the work, so it can't be stopped.</p>
<p>Just make sure that your actions are descriptions of side effects and not actually side effects. Thunks are opaque so not the best descriptions, but they are lazy and thus count as descriptions of side effects.</p>
<p><a id="routing"></a></p>
<h3>Routing</h3>
<p>Routing can get a little weird, because the browser owns some of the state about the current location, and it owns some actions for changing the location. Once you start using Redux, you might start wanting your routing state inside the Redux store. I did, so I built a <a href="https://github.com/zapier/redux-router-kit">router to do that</a>! The new version of <a href="https://reacttraining.com/react-router/">React Router</a> is very cool, and there are other non-Redux routing solutions you may want to use. For the most part, if you do that, you'll probably want to have the routing library do as much of its job as possible without trying to sync state.</p>
<h3>Everything Else</h3>
<p>There's a big ecosystem of middleware and tools built on top of Redux. Following are just a <em>few</em> of the many things available. Feel free to look around, but I recommend getting confident with the basics first!</p>
<p>Youll definitely want to check out the <a href="https://github.com/zalmoxisus/redux-devtools-extension">Redux DevTools extension</a> or the <a href="https://github.com/gaearon/redux-devtools">Redux DevTools</a> themselves. The extension is generally the easiest way to use the DevTools.</p>
<p>The <a href="https://github.com/evgenyrodionov/redux-logger">Logger for Redux</a> is a handy piece of middleware for logging actions to the console.</p>
<p>If you want to dispatch multiple synchronous actions but only want to kick off a single re-render, <a href="https://github.com/tshelburne/redux-batched-actions">redux-batched-actions</a> or <a href="https://github.com/manaflair/redux-batch">redux-batch</a> can help.</p>
<p>If asynchronous actions or side effects seem to be getting unwieldy with <a href="https://github.com/gaearon/redux-thunk">redux-thunk</a>, and you dont want to write your own middleware solution, you can check out something like <a href="https://github.com/redux-saga/redux-saga">redux-saga</a> or <a href="https://github.com/jeffbski/redux-logic">redux-logic</a>. Or, if you want to go further down the rabbit hole, <a href="https://github.com/redux-loop/redux-loop">redux-loop</a> is pretty interesting.</p>
<p>If you want to use GraphQL, check out <a href="http://dev.apollodata.com/">Apollo</a> which integrates with Redux.</p>
<p>Have fun! </p>

          
        </div>
        <div class="column one-third content ">
          
  <div class="email-subscribe widget primary">
    <h3>Build Great APIs</h3>
    <p class="small">Get new articles about API design, documentation, and success delivered to your inbox.</p>

    
      

<form class="paramform" enctype="multipart/form-data" method="post"><input type='hidden' name='csrfmiddlewaretoken' value='bFG6RbFwmSHkKsh7p5TZbvuvwIvO5fHs' />

  

  <div class="fields">
    
      
        

<div class="field ">
  
  

  <div class="input">
    <input id="id_email" name="email" placeholder="Your email..." type="text" />
  </div>

  <br />

  

</div>

      
    
  </div>

  

  <input class="button button--block large blue  big orange" type="submit" value="Subscribe" /> 
</form>

    
  </div>

  <div class="social">
    <ul>
      <li><a href="https://twitter.com/zapier" class="twitter" title="Follow @zapier on Twitter"><i class="fa fa-twitter"></i></a></li>
      <li><a href="http://www.linkedin.com/company/zapier/" class="linkedin" title="Follow us on LinkedIn"><i class="fa fa-linkedin"></i></a></li>
      <li><a href="https://plus.google.com/105298426206075552003/" class="google-plus" title="Follow us on Google+"><i class="fa fa-google-plus"></i></a></li>
      <li><a href="https://zapier.com/engineering/feeds/latest/" class="rss"><i class="fa fa-rss"></i></a></li>
    </ul>
  </div>

  
    <div class="widget">
        <h3>Automate Your Work</h3>
        <p class="small">Zapier connects hundreds of apps to give you the integrations you need. Easily automate tedious tasks to let Zapier do the work for you.</p>
        <a href="https://zapier.com/sign-up" class="button outlined">Try it Free</a>
    </div>
  

  <div class="widget">
    <h3>Recent Posts</h3>
    <ul class="small">
      
        <li><a href="https://zapier.com/engineering/worthless-integrations/">3 Reasons Why Your Integrations Might Be Worthless</a></li>
      
        <li><a href="https://zapier.com/engineering/api-planned-downtime/">How to Handle Planned Downtime for Your API</a></li>
      
        <li><a href="https://zapier.com/engineering/graph-apis/">Introduction to Graph APIs</a></li>
      
        <li><a href="https://zapier.com/engineering/api-audiences/">You Need These Three People to Care About Your API</a></li>
      
        <li><a href="https://zapier.com/engineering/zapier-issues/">Introducing Zapier Issues: Your Product Development Partner</a></li>
      
        <li><a href="https://zapier.com/engineering/ansible-molecule/">How We Test Our Ansible Roles with Molecule</a></li>
      
        <li><a href="https://zapier.com/engineering/qim-immutable-javascript/">Qim: Select from Your Immutable JavaScript Cake and Update It Symmetrically Too</a></li>
      
        <li><a href="https://zapier.com/engineering/startup-cto/">The CTO Journey at a Small Startup</a></li>
      
        <li><a href="https://zapier.com/engineering/api-authentication/">Authentication for Great Apps</a></li>
      
        <li><a href="https://zapier.com/engineering/api-geriatrics/">API Geriatrics</a></li>
      
    </ul>
  </div>

  <div class="widget updates-index-cta center">
    <p class="small"><a href="https://zapier.com/engineering/">See All Engineering Posts</a></p>
  </div>

        </div>
      </div>
    </div>
    
  <div class="row">
    <div class="container center">
      <hr class="haircut" />
      <div class="share-buttons-vertical">
  <div class="single-share">
    
    <a href="https://twitter.com/share?text=The%20Zapier%20Engineering%20Blog%20-%20Zapier&amp;url=https://zapier.com/engineering/how-to-build-redux/&amp;via=zapier" class="twitter-share-button" data-via="zapier" data-count="vertical" data-url="https://zapier.com/engineering/how-to-build-redux/" data-width="59">Tweet</a>
  </div>
  <div class="single-share">
    
    <script type="IN/Share" data-counter="top"></script>
  </div>
  <div class="single-share">
    
    <div class="fb-like" data-layout="box_count" data-action="like" data-show-faces="false" data-share="false" data-href="https://zapier.com/engineering/how-to-build-redux/"></div>
  </div>
  <div class="single-share">
    
    <div class="g-plusone" data-size="tall" data-href="https://zapier.com/engineering/how-to-build-redux/"></div>
  </div>
</div>
    </div>
  </div>
  

  


<div class="row blog-footer blog-bordered">
  <div class="container author">
    <div class="table-wrapper">
      <div class="table-cell vtop">
        <div class="picture" title="Justin Deal">
          <img src="https://secure.gravatar.com/avatar/d266d8fcf04d5d065ca632e642d01dcd.jpg?s=75&amp;r=G" alt="Justin Deal"/>
        </div>
      </div>
      <div class="text table-cell vtop">
        <h3 class="haircut">About the Author</h3>
        <p class="bio">Justin Deal is a Frontend Engineer for Zapier who lives in St. Louis with his wife and two kids and dog. He loves to code, especially JavaScript, and occasionally write some music.</p>
      </div>
    </div>
  </div>
</div>


  
  <div class="row blog comments blog-bordered">
    <div class="container">
        <a id="disqus_load_comments" href="index.html#comments">Load Comments...</a>
        <div id="disqus_comments" class="disqus_comments--hidden">
            <a name="comments"></a>
            <div id="disqus_thread"></div>
            <script type="text/javascript">
                function stripQueryStringAndHashFromPath(url) {
                    return url.split("?")[0].split("#")[0];
                }

                /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
                var disqus_shortname = 'zapier'; // required: replace example with your forum shortname
                var disqus_url = stripQueryStringAndHashFromPath(window.location.href);

                /* * * DON'T EDIT BELOW THIS LINE * * */
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            </script>
            <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">Comments powered by Disqus.</a></noscript>
            <p><a href="https://disqus.com" class="dsq-brlink">Comments powered by <span class="logo-disqus">Disqus</span></a></p>
        </div>
    </div>
  </div>
  <script type="text/javascript">
  (function(){
    var commentsLink = document.getElementById('disqus_load_comments');
    if(commentsLink){
        commentsLink.addEventListener('click', function(e){
            if(e){
                e.preventDefault();
            }
            var comments = document.getElementById('disqus_comments');
            if(comments){
                comments.className = '';
            }
            commentsLink.parentElement.removeChild(commentsLink);
        }, true);
    }
  }());
  </script>



  </div>

    </div>
  </div>






<script type="text/javascript" src="https://cdn.zapier.com/static/1DNUis/build/vendor.js" charset="utf-8"></script>
<script type="text/javascript" src="https://cdn.zapier.com/static/1DNUis/build/external.js" charset="utf-8"></script>


  <script type="text/javascript" src="https://cdn.zapier.com/static/1DNUis/build/common.js" charset="utf-8"></script>
  <script type="text/javascript" src="https://cdn.zapier.com/static/1DNUis/build/app.js" charset="utf-8"></script>
  <script type="text/javascript" src="https://cdn.zapier.com/static/1DNUis/build/templates.js" charset="utf-8"></script>




<script type="text/javascript">
BASE_CONFIG.loadPrivateResources = function () {
  if (BASE_CONFIG.privateStyleSheetLogos) {
    document.getElementsByTagName('head')[0].removeChild(BASE_CONFIG.privateStyleSheetLogos);
  }
  BASE_CONFIG.privateStyleSheetLogos = document.createElement('link');
  BASE_CONFIG.privateStyleSheetLogos.href = '/generated/private-logos.css';
  BASE_CONFIG.privateStyleSheetLogos.rel = 'stylesheet';
  BASE_CONFIG.privateStyleSheetLogos.type = 'text/css';
  document.getElementsByTagName('head')[0].appendChild(BASE_CONFIG.privateStyleSheetLogos);
};
setTimeout(function() {
  

  var globalStyleSheetLogos = document.createElement('link');
  globalStyleSheetLogos.href = '/generated/global-logos.css';
  globalStyleSheetLogos.rel = 'stylesheet';
  globalStyleSheetLogos.type = 'text/css';
  document.getElementsByTagName('head')[0].appendChild(globalStyleSheetLogos);
}, 0);
</script>


  
  
  
    
  
    
      <!-- Google Code for Visited Zapier -->
      <script type="text/javascript">
      /* <![CDATA[ */
      var google_conversion_id = 1002491550;
      var google_conversion_label = "pz-iCPqG7QIQnp2D3gM";
      var google_custom_params = window.google_tag_params;
      var google_remarketing_only = true;
      /* ]]> */
      </script>
      <script type="text/javascript" src="https://www.googleadservices.com/pagead/conversion.js">
      </script>
      <noscript>
      <div style="display:inline;">
      <img height="1" width="1" style="border-style:none;" alt="" src="https://googleads.g.doubleclick.net/pagead/viewthroughconversion/1002491550/?value=0&amp;label=pz-iCPqG7QIQnp2D3gM&amp;guid=ON&amp;script=0"/>
      </div>
      </noscript>
    
  

    
      


      



    
  

  <div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=234230510040096";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
<script type="text/javascript">
  (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  })();
</script>
<script src="https://platform.linkedin.com/in.js" type="text/javascript">
  lang: en_US
</script>

  <div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=234230510040096";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
<script type="text/javascript">
  (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  })();
</script>
<script src="https://platform.linkedin.com/in.js" type="text/javascript">
  lang: en_US
</script>

</body>
</html>
